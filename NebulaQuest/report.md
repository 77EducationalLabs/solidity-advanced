# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: `abi.encodePacked()` should not be used with dynamic types when passing the result to a hash function such as `keccak256()`](#h-1-abiencodepacked-should-not-be-used-with-dynamic-types-when-passing-the-result-to-a-hash-function-such-as-keccak256)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk for trusted owners](#l-1-centralization-risk-for-trusted-owners)
  - [L-2: `public` functions not used internally could be marked `external`](#l-2-public-functions-not-used-internally-could-be-marked-external)
  - [L-3: Event is missing `indexed` fields](#l-3-event-is-missing-indexed-fields)
  - [L-4: Unused Custom Error](#l-4-unused-custom-error)
  - [L-5: Potentially unused `private` / `internal` state variables found.](#l-5-potentially-unused-private--internal-state-variables-found)
  - [L-6: Uninitialized local variables.](#l-6-uninitialized-local-variables)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 3 |
| Total nSLOC | 220 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| src/NebulaEvolution.sol | 116 |
| src/NebulaQuest.sol | 78 |
| src/NebulaQuestCoin.sol | 26 |
| **Total** | **220** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 1 |
| Low | 6 |


# High Issues

## H-1: `abi.encodePacked()` should not be used with dynamic types when passing the result to a hash function such as `keccak256()`

Use `abi.encode()` instead which will pad items to 32 bytes, which will [prevent hash collisions](https://docs.soliditylang.org/en/v0.8.13/abi-spec.html#non-standard-packed-mode) (e.g. `abi.encodePacked(0x123,0x456)` => `0x123456` => `abi.encodePacked(0x1,0x23456)`, but `abi.encode(0x123,0x456)` => `0x0...1230...456`). Unless there is a compelling reason, `abi.encode` should be preferred. If there is only one argument to `abi.encodePacked()` it can often be cast to `bytes()` or `bytes32()` [instead](https://ethereum.stackexchange.com/questions/30912/how-to-compare-strings-in-solidity#answer-82739).
If all arguments are strings and or bytes, `bytes.concat()` should be used instead.

<details><summary>4 Found Instances</summary>


- Found in src/NebulaEvolution.sol [Line: 98](src/NebulaEvolution.sol#L98)

	```solidity
	                    abi.encodePacked(
	```

- Found in src/NebulaEvolution.sol [Line: 114](src/NebulaEvolution.sol#L114)

	```solidity
	            abi.encodePacked("data:application/json;base64,", uri)
	```

- Found in src/NebulaEvolution.sol [Line: 184](src/NebulaEvolution.sol#L184)

	```solidity
	                    abi.encodePacked(
	```

- Found in src/NebulaEvolution.sol [Line: 201](src/NebulaEvolution.sol#L201)

	```solidity
	            abi.encodePacked("data:application/json;base64,", uri)
	```

</details>



# Low Issues

## L-1: Centralization Risk for trusted owners

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>9 Found Instances</summary>


- Found in src/NebulaEvolution.sol [Line: 20](src/NebulaEvolution.sol#L20)

	```solidity
	contract NebulaEvolution is ERC721, ERC721URIStorage, AccessControl {
	```

- Found in src/NebulaEvolution.sol [Line: 90](src/NebulaEvolution.sol#L90)

	```solidity
	    function safeMint(address _user) external onlyRole(MINTER_ROLE) returns(uint256 tokenId){
	```

- Found in src/NebulaEvolution.sol [Line: 131](src/NebulaEvolution.sol#L131)

	```solidity
	    function updateNFT(uint256 _tokenId, uint256 _exp) external onlyRole(MINTER_ROLE){
	```

- Found in src/NebulaEvolution.sol [Line: 153](src/NebulaEvolution.sol#L153)

	```solidity
	    function levelsSetter(uint256 _level, uint256 _amountOfExp) external onlyRole(DEFAULT_ADMIN_ROLE) {
	```

- Found in src/NebulaQuest.sol [Line: 28](src/NebulaQuest.sol#L28)

	```solidity
	contract NebulaQuest is Ownable, ReentrancyGuard {
	```

- Found in src/NebulaQuest.sol [Line: 131](src/NebulaQuest.sol#L131)

	```solidity
	    function answerSetter(uint8 _examIndex, bytes32[] memory _correctAnswers) external onlyOwner {
	```

- Found in src/NebulaQuestCoin.sol [Line: 26](src/NebulaQuestCoin.sol#L26)

	```solidity
	contract NebulaQuestCoin is ERC20, AccessControl, ERC20Permit {
	```

- Found in src/NebulaQuestCoin.sol [Line: 89](src/NebulaQuestCoin.sol#L89)

	```solidity
	    function mint(address _to, uint256 _amount) external onlyRole(MINTER_ROLE){
	```

- Found in src/NebulaQuestCoin.sol [Line: 100](src/NebulaQuestCoin.sol#L100)

	```solidity
	    function burn(uint256 _amount) external onlyRole(MINTER_ROLE){
	```

</details>



## L-2: `public` functions not used internally could be marked `external`

Instead of marking a function as `public`, consider marking it as `external` if it is not used internally.

<details><summary>2 Found Instances</summary>


- Found in src/NebulaEvolution.sol [Line: 163](src/NebulaEvolution.sol#L163)

	```solidity
	    function supportsInterface(bytes4 interfaceId) public view override(ERC721, ERC721URIStorage, AccessControl) returns (bool){
	```

- Found in src/NebulaEvolution.sol [Line: 168](src/NebulaEvolution.sol#L168)

	```solidity
	    function tokenURI(uint256 tokenId) public view override(ERC721, ERC721URIStorage) returns (string memory){
	```

</details>



## L-3: Event is missing `indexed` fields

Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

<details><summary>8 Found Instances</summary>


- Found in src/NebulaEvolution.sol [Line: 52](src/NebulaEvolution.sol#L52)

	```solidity
	    event NebulaEvolution_TheGasIsFreezingABirthIsOnTheWay(uint256 tokenId);
	```

- Found in src/NebulaEvolution.sol [Line: 54](src/NebulaEvolution.sol#L54)

	```solidity
	    event NebulaEvolution_LevelUpdated(uint256 level,  uint256 amountOfExp);
	```

- Found in src/NebulaEvolution.sol [Line: 56](src/NebulaEvolution.sol#L56)

	```solidity
	    event NebulaEvolution_NFTUpdated(uint256 tokenId, string finalURI);
	```

- Found in src/NebulaQuest.sol [Line: 69](src/NebulaQuest.sol#L69)

	```solidity
	    event NebulaQuest_ExamPassed(address user, uint8 examIndex, uint16 score);
	```

- Found in src/NebulaQuest.sol [Line: 71](src/NebulaQuest.sol#L71)

	```solidity
	    event NebulaQuest_ExamFailed(address user, uint8 examIndex, uint16 score);
	```

- Found in src/NebulaQuest.sol [Line: 73](src/NebulaQuest.sol#L73)

	```solidity
	    event NebulaQuest_AnswersUpdated(uint8 examIndex);
	```

- Found in src/NebulaQuestCoin.sol [Line: 43](src/NebulaQuestCoin.sol#L43)

	```solidity
	    event NebulaQuestCoin_TokenMinted(address _to, uint256 _amount);
	```

- Found in src/NebulaQuestCoin.sol [Line: 45](src/NebulaQuestCoin.sol#L45)

	```solidity
	    event NebulaQuestCoin_TokenBurned(uint256 _amount);
	```

</details>



## L-4: Unused Custom Error

it is recommended that the definition be removed when custom error is unused

<details><summary>1 Found Instances</summary>


- Found in src/NebulaQuest.sol [Line: 22](src/NebulaQuest.sol#L22)

	```solidity
	error NebulaQuest_InvalidScore(uint16 scoreInput, uint16 minScore, uint16 maxScore);
	```

</details>



## L-5: Potentially unused `private` / `internal` state variables found.

State variable appears to be unused. No analysis has been performed to see if any inilne assembly references it. So if that's not the case, consider removing this unused variable.

<details><summary>1 Found Instances</summary>


- Found in src/NebulaQuest.sol [Line: 49](src/NebulaQuest.sol#L49)

	```solidity
	    uint16 constant MAX_SCORE = 1_000;
	```

</details>



## L-6: Uninitialized local variables.

Initialize all the variables. If a variable is meant to be initialized to zero, explicitly set it to zero to improve code readability.

<details><summary>1 Found Instances</summary>


- Found in src/NebulaQuest.sol [Line: 107](src/NebulaQuest.sol#L107)

	```solidity
	        for (uint256 i; i < examAnswers.length; ++i){
	```

</details>



